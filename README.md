LIDER Code Generation for LLOD-Aware Services
=============================================

Generating Code from OWL
------------------------

The first step is to create the Java Class files from the Ontology. This is 
first done by creating a JSON-LD context document to define the set of properties
and classes that are of interest the extraction procedure. For example, we will
use the two [NIF](http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core)
properties `subString` and `anchorOf`:

    {
        "String": http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#String",
        "anchorOf": "http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#anchorOf",
        "subString": {
            "@id": "http://persistence.uni-leipzig.org/nlp2rdf/ontologies/nif-core#subString",
            "@type": "@id"
        }
    }

Once we have done this we will use the code generator to generate Java classes 
for this context:

    ./codegen -p example/src/main/java/ java file:test.json 

This now creates the class `org.unileipzig.persistence.nlp2rdf.ontologies.nifcore.String_`.

Writing a service
-----------------

A service consists of a class that has a method that takes a single parameter,
which is a class generated by the code generator, and returns an instance of the
generated class. For example we can define a simple tokenizer as follows:

    public class Tokenizer {
        public String_ tokenize(String_ nifString) {
            final String string = nifString.getAnchorOf().iterator().next();
            final String[] tokenized = string.replaceAll("(\\.\\.\\.+|[\\p{Po}\\p{Ps}\\p{Pe}\\p{Pi}\\p{Pf}\u2013\u2014\u2015&&[^'\\.]]|(?<!(\\.|\\.\\p{L}))\\.(?=[\\p{Z}\\p{Pf}\\p{Pe}]|\\Z)|(?<!\\p{L})'(?!\\p{L}))"," $1 ")
                .replaceAll("\\p{C}|^\\p{Z}+|\\p{Z}+$","")
                .split("\\p{Z}+");
    
            final String_ nifTokenized = new String_("result");
            nifTokenized.addAnchorOf(string);
    
            for(int i = 0; i < tokenized.length; i++) {
                final String_ token = new String_("token" + i);
                token.addAnchorOf(tokenized[i]);
                nifTokenized.addSubString(token);
            }        
    
            return nifTokenized;
        }
    }

Deploying a server
------------------

A REST-service for deploying these services is given in the `service` folder.
It requires a configuration of the services as a JSON document, such as
follows:

    {
        "services": [{
            "jar": "../example/target/codegen.example-1.0-SNAPSHOT.jar",
            "className": "eu.liderproject.codegen.example.Tokenizer",
            "methods": ["tokenize"],
            "path": "/"
        }]
    }

This states that we will load the `Tokenizer` class from the external JAR and
publish the `tokenize` method as a service. The service can be started as 
follows:

    mvn exec:java -Dexec.mainClass="eu.liderproject.codegen.server.Main" -Dexec.args="config.json"

We can test this service by posting a Turtle document to the service as follows:

    curl -d @src/test/resources/test.rdf http://localhost:8080/tokenize
